# Tennis-Frog åç«¯æœåŠ¡å¼€å‘ä»»åŠ¡è§„åˆ’

> é¡¹ç›®åç§°ï¼šTennis-Frog ç½‘çƒç¤¾äº¤å¹³å°  
> æŠ€æœ¯æ ˆï¼šFastAPI + Python 3.10+ + PostgreSQL  
> å¼€å‘æ—¥æœŸï¼š2025-11-06

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [å¼€å‘é˜¶æ®µè§„åˆ’](#å¼€å‘é˜¶æ®µè§„åˆ’)
3. [è¯¦ç»†ä»»åŠ¡æ¸…å•](#è¯¦ç»†ä»»åŠ¡æ¸…å•)
4. [æŠ€æœ¯æ ˆä¸ä¾èµ–](#æŠ€æœ¯æ ˆä¸ä¾èµ–)
5. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
6. [å¼€å‘ä¼˜å…ˆçº§](#å¼€å‘ä¼˜å…ˆçº§)
7. [æµ‹è¯•è®¡åˆ’](#æµ‹è¯•è®¡åˆ’)
8. [éƒ¨ç½²è®¡åˆ’](#éƒ¨ç½²è®¡åˆ’)

---

## é¡¹ç›®æ¦‚è¿°

### ç›®æ ‡
æ„å»ºä¸€ä¸ªå®Œæ•´çš„åç«¯APIæœåŠ¡ï¼Œæ”¯æŒFlutterå‰ç«¯çš„æ‰€æœ‰åŠŸèƒ½éœ€æ±‚ï¼ŒåŒ…æ‹¬ï¼š
- âœ… ç”¨æˆ·è®¤è¯ï¼ˆæ‰‹æœºå·éªŒè¯ç ç™»å½•ï¼‰
- âœ… ç”¨æˆ·ç®¡ç†ï¼ˆèµ„æ–™ã€å¤´åƒï¼‰
- âœ… å¸–å­ç®¡ç†ï¼ˆCRUDã€ç‚¹èµã€è¯„è®ºï¼‰
- âœ… æ¯”èµ›ç®¡ç†ï¼ˆCRUDã€å‚ä¸ï¼‰
- âœ… æ¶ˆæ¯ç³»ç»Ÿï¼ˆç§ä¿¡ã€ä¼šè¯ï¼‰
- âœ… é€šçŸ¥ç³»ç»Ÿ

### æŠ€æœ¯é€‰å‹
- **Webæ¡†æ¶**ï¼šFastAPI 0.104+
- **ç¼–ç¨‹è¯­è¨€**ï¼šPython 3.10+
- **æ•°æ®åº“**ï¼šPostgreSQL 14+
- **ORM**ï¼šSQLAlchemy 2.0+
- **è®¤è¯**ï¼šJWT (PyJWT)
- **éªŒè¯ç **ï¼šé˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡
- **æ–‡ä»¶å­˜å‚¨**ï¼šé˜¿é‡Œäº‘OSS
- **ç¼“å­˜**ï¼šRedisï¼ˆå¯é€‰ï¼‰

---

## å¼€å‘é˜¶æ®µè§„åˆ’

### é˜¶æ®µä¸€ï¼šåŸºç¡€æ­å»ºï¼ˆä¼˜å…ˆçº§ï¼šğŸ”´ æœ€é«˜ï¼‰
**ç›®æ ‡**ï¼šæ­å»ºé¡¹ç›®éª¨æ¶ï¼Œé…ç½®å¼€å‘ç¯å¢ƒ

- [x] é¡¹ç›®åˆå§‹åŒ–
- [ ] æ•°æ®åº“é…ç½®
- [ ] æ ¸å¿ƒé…ç½®æ¨¡å—
- [ ] æ•°æ®æ¨¡å‹å®šä¹‰
- [ ] Schemaå®šä¹‰

**é¢„è®¡æ—¶é—´**ï¼š2-3å¤©

---

### é˜¶æ®µäºŒï¼šè®¤è¯ç³»ç»Ÿï¼ˆä¼˜å…ˆçº§ï¼šğŸ”´ æœ€é«˜ï¼‰
**ç›®æ ‡**ï¼šå®ç°å®Œæ•´çš„ç”¨æˆ·è®¤è¯æµç¨‹

- [ ] çŸ­ä¿¡æœåŠ¡é›†æˆ
- [ ] å‘é€éªŒè¯ç API
- [ ] éªŒè¯ç ç™»å½•API
- [ ] Tokenåˆ·æ–°API
- [ ] ç™»å‡ºAPI

**é¢„è®¡æ—¶é—´**ï¼š3-4å¤©

---

### é˜¶æ®µä¸‰ï¼šç”¨æˆ·ç®¡ç†ï¼ˆä¼˜å…ˆçº§ï¼šğŸŸ¡ é«˜ï¼‰
**ç›®æ ‡**ï¼šå®ç°ç”¨æˆ·ä¿¡æ¯ç®¡ç†åŠŸèƒ½

- [ ] è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯API
- [ ] æ›´æ–°ç”¨æˆ·èµ„æ–™API
- [ ] ä¸Šä¼ å¤´åƒAPIï¼ˆOSSé›†æˆï¼‰
- [ ] ç”¨æˆ·å…³æ³¨åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

**é¢„è®¡æ—¶é—´**ï¼š2-3å¤©

---

### é˜¶æ®µå››ï¼šæ ¸å¿ƒåŠŸèƒ½ï¼ˆä¼˜å…ˆçº§ï¼šğŸŸ¡ é«˜ï¼‰
**ç›®æ ‡**ï¼šå®ç°å¸–å­å’Œæ¯”èµ›ç®¡ç†

- [ ] å¸–å­CRUD API
- [ ] å¸–å­ç‚¹èµ/è¯„è®ºAPI
- [ ] æ¯”èµ›CRUD API
- [ ] æ¯”èµ›å‚ä¸API

**é¢„è®¡æ—¶é—´**ï¼š4-5å¤©

---

### é˜¶æ®µäº”ï¼šæ‰©å±•åŠŸèƒ½ï¼ˆä¼˜å…ˆçº§ï¼šğŸŸ¢ ä¸­ï¼‰
**ç›®æ ‡**ï¼šå®ç°æ¶ˆæ¯å’Œé€šçŸ¥ç³»ç»Ÿ

- [ ] æ¶ˆæ¯ç³»ç»ŸAPI
- [ ] é€šçŸ¥ç³»ç»ŸAPI
- [ ] WebSocketå®æ—¶é€šä¿¡ï¼ˆå¯é€‰ï¼‰

**é¢„è®¡æ—¶é—´**ï¼š3-4å¤©

---

### é˜¶æ®µå…­ï¼šä¼˜åŒ–ä¸éƒ¨ç½²ï¼ˆä¼˜å…ˆçº§ï¼šğŸŸ¢ ä¸­ï¼‰
**ç›®æ ‡**ï¼šæ€§èƒ½ä¼˜åŒ–å’Œç”Ÿäº§éƒ¨ç½²

- [ ] é”™è¯¯å¤„ç†ä¼˜åŒ–
- [ ] ä¸­é—´ä»¶å®Œå–„
- [ ] å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- [ ] Dockeréƒ¨ç½²é…ç½®
- [ ] ç”Ÿäº§ç¯å¢ƒé…ç½®

**é¢„è®¡æ—¶é—´**ï¼š2-3å¤©

---

## è¯¦ç»†ä»»åŠ¡æ¸…å•

### ğŸ“ é˜¶æ®µä¸€ï¼šåŸºç¡€æ­å»º

#### 1.1 é¡¹ç›®åˆå§‹åŒ–
- [ ] åˆ›å»º `backend/` ç›®å½•
- [ ] åˆ›å»ºé¡¹ç›®ç›®å½•ç»“æ„
- [ ] åˆ›å»º `requirements.txt` ä¾èµ–æ–‡ä»¶
- [ ] åˆ›å»º `.env.example` ç¯å¢ƒå˜é‡æ¨¡æ¿
- [ ] åˆ›å»º `.gitignore` æ–‡ä»¶
- [ ] åˆ›å»º `README.md` é¡¹ç›®è¯´æ˜

**æ–‡ä»¶ç»“æ„**ï¼š
```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ schemas/
â”‚   â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ services/
â”‚   â””â”€â”€ utils/
â”œâ”€â”€ tests/
â”œâ”€â”€ alembic/
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ .env.example
â”œâ”€â”€ .gitignore
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ README.md
```

---

#### 1.2 æ•°æ®åº“é…ç½®
- [ ] å®‰è£… PostgreSQLï¼ˆæœ¬åœ°æˆ–Dockerï¼‰
- [ ] åˆ›å»ºæ•°æ®åº“ `tennis_frog`
- [ ] é…ç½® `app/core/database.py`
- [ ] é…ç½® SQLAlchemy è¿æ¥æ± 
- [ ] åˆå§‹åŒ– Alembic è¿ç§»å·¥å…·
- [ ] åˆ›å»ºåˆå§‹è¿ç§»æ–‡ä»¶

**å…³é”®é…ç½®**ï¼š
```python
# app/core/database.py
DATABASE_URL = "postgresql://user:password@localhost:5432/tennis_frog"
engine = create_engine(DATABASE_URL, pool_size=20, max_overflow=10)
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)
```

---

#### 1.3 æ ¸å¿ƒé…ç½®æ¨¡å—
- [ ] åˆ›å»º `app/core/config.py`ï¼ˆç¯å¢ƒå˜é‡ç®¡ç†ï¼‰
- [ ] åˆ›å»º `app/core/security.py`ï¼ˆJWTå·¥å…·å‡½æ•°ï¼‰
- [ ] åˆ›å»º `app/core/database.py`ï¼ˆæ•°æ®åº“è¿æ¥ï¼‰
- [ ] åˆ›å»º `app/utils/exceptions.py`ï¼ˆå¼‚å¸¸å¤„ç†ï¼‰

**é…ç½®é¡¹**ï¼š
- åº”ç”¨é…ç½®ï¼ˆAPP_NAME, DEBUG, SECRET_KEYï¼‰
- æ•°æ®åº“é…ç½®ï¼ˆDATABASE_URLï¼‰
- JWTé…ç½®ï¼ˆSECRET_KEY, ALGORITHM, EXPIREï¼‰
- çŸ­ä¿¡æœåŠ¡é…ç½®ï¼ˆSMS_ACCESS_KEY_ID, SMS_ACCESS_KEY_SECRETï¼‰
- OSSé…ç½®ï¼ˆOSS_ENDPOINT, OSS_BUCKET_NAMEï¼‰
- Redisé…ç½®ï¼ˆå¯é€‰ï¼‰

---

#### 1.4 æ•°æ®æ¨¡å‹å®šä¹‰
æ ¹æ® `æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md` åˆ›å»ºä»¥ä¸‹æ¨¡å‹ï¼š

- [ ] `app/models/user.py` - ç”¨æˆ·æ¨¡å‹
- [ ] `app/models/sms_code.py` - éªŒè¯ç æ¨¡å‹
- [ ] `app/models/session.py` - ä¼šè¯æ¨¡å‹
- [ ] `app/models/login_log.py` - ç™»å½•æ—¥å¿—æ¨¡å‹ï¼ˆå¯é€‰ï¼‰

**å…³é”®å­—æ®µ**ï¼š
- User: id, phone, country_code, username, avatar, nickname, skill_levelç­‰
- SmsCode: id, phone, code, expires_at, is_used
- Session: id, user_id, device_id, access_token, refresh_token, expires_at

---

#### 1.5 Schemaå®šä¹‰
åˆ›å»º Pydantic Schema ç”¨äºè¯·æ±‚/å“åº”éªŒè¯ï¼š

- [ ] `app/schemas/auth.py`
  - `SendSmsCodeRequest`
  - `LoginWithSmsRequest`
  - `SmsLoginResponse`
  - `TokenResponse`
  - `RefreshTokenRequest`

- [ ] `app/schemas/user.py`
  - `UserResponse`
  - `UserUpdate`
  - `UserCreate`

- [ ] `app/schemas/common.py`
  - `ResponseModel`ï¼ˆç»Ÿä¸€å“åº”æ ¼å¼ï¼‰
  - `ErrorResponse`ï¼ˆé”™è¯¯å“åº”æ ¼å¼ï¼‰

---

### ğŸ“ é˜¶æ®µäºŒï¼šè®¤è¯ç³»ç»Ÿ

#### 2.1 çŸ­ä¿¡æœåŠ¡é›†æˆ
- [ ] åˆ›å»º `app/services/sms_service.py`
- [ ] é›†æˆé˜¿é‡Œäº‘çŸ­ä¿¡SDK
- [ ] å®ç°å‘é€éªŒè¯ç åŠŸèƒ½
- [ ] å®ç°éªŒè¯ç ç”Ÿæˆé€»è¾‘ï¼ˆ4ä½æ•°å­—ï¼‰
- [ ] å®ç°éªŒè¯ç å­˜å‚¨ï¼ˆæ•°æ®åº“ï¼‰
- [ ] å®ç°é¢‘ç‡é™åˆ¶ï¼ˆ60ç§’/æ¬¡ï¼‰

**å…³é”®åŠŸèƒ½**ï¼š
```python
async def send_sms_code(phone: str, country_code: str) -> bool:
    # 1. æ£€æŸ¥é¢‘ç‡é™åˆ¶
    # 2. ç”Ÿæˆ4ä½éªŒè¯ç 
    # 3. ä¿å­˜åˆ°æ•°æ®åº“ï¼ˆsms_verification_codesè¡¨ï¼‰
    # 4. è°ƒç”¨é˜¿é‡Œäº‘çŸ­ä¿¡APIå‘é€
    # 5. è¿”å›ç»“æœ
```

---

#### 2.2 å‘é€éªŒè¯ç API
- [ ] åˆ›å»º `app/api/v1/auth.py` è·¯ç”±æ–‡ä»¶
- [ ] å®ç° `POST /api/v1/auth/send-sms-code`
- [ ] è¯·æ±‚å‚æ•°éªŒè¯ï¼ˆphone, country_code, device_infoï¼‰
- [ ] è°ƒç”¨çŸ­ä¿¡æœåŠ¡
- [ ] è¿”å›ç»Ÿä¸€å“åº”æ ¼å¼
- [ ] é”™è¯¯å¤„ç†ï¼ˆé¢‘ç‡é™åˆ¶ã€å‘é€å¤±è´¥ç­‰ï¼‰

**APIè§„èŒƒ**ï¼š
```python
@router.post("/send-sms-code", response_model=ResponseModel)
async def send_sms_code(
    request: SendSmsCodeRequest,
    db: Session = Depends(get_db)
):
    # å®ç°é€»è¾‘
```

---

#### 2.3 éªŒè¯ç ç™»å½•API
- [ ] å®ç° `POST /api/v1/auth/login-with-sms`
- [ ] éªŒè¯ç æ ¡éªŒï¼ˆéªŒè¯ç ã€è¿‡æœŸæ—¶é—´ã€æ˜¯å¦å·²ä½¿ç”¨ï¼‰
- [ ] ç”¨æˆ·åˆ›å»ºæˆ–æŸ¥è¯¢ï¼ˆæ‰‹æœºå·ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»ºï¼‰
- [ ] ç”ŸæˆJWT Tokenï¼ˆaccess_token + refresh_tokenï¼‰
- [ ] åˆ›å»ºç”¨æˆ·ä¼šè¯ï¼ˆä¿å­˜åˆ°sessionsè¡¨ï¼‰
- [ ] æ›´æ–°ç”¨æˆ·æœ€åç™»å½•æ—¶é—´
- [ ] è¿”å›ç”¨æˆ·ä¿¡æ¯å’ŒToken

**å…³é”®é€»è¾‘**ï¼š
```python
async def login_with_sms(
    request: LoginWithSmsRequest,
    db: Session = Depends(get_db)
):
    # 1. éªŒè¯éªŒè¯ç 
    # 2. æŸ¥æ‰¾æˆ–åˆ›å»ºç”¨æˆ·
    # 3. ç”ŸæˆToken
    # 4. åˆ›å»ºä¼šè¯
    # 5. è¿”å›å“åº”
```

---

#### 2.4 Tokenåˆ·æ–°API
- [ ] å®ç° `POST /api/v1/auth/refresh-token`
- [ ] éªŒè¯refresh_tokenæœ‰æ•ˆæ€§
- [ ] ç”Ÿæˆæ–°çš„access_token
- [ ] æ›´æ–°ä¼šè¯ä¿¡æ¯
- [ ] è¿”å›æ–°Token

---

#### 2.5 ç™»å‡ºAPI
- [ ] å®ç° `POST /api/v1/auth/logout`
- [ ] éªŒè¯access_token
- [ ] åˆ é™¤æˆ–æ ‡è®°ä¼šè¯ä¸ºæ— æ•ˆ
- [ ] æ”¯æŒå•è®¾å¤‡ç™»å‡ºæˆ–å…¨éƒ¨ç™»å‡º
- [ ] è¿”å›æˆåŠŸå“åº”

---

### ğŸ“ é˜¶æ®µä¸‰ï¼šç”¨æˆ·ç®¡ç†

#### 3.1 è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯API
- [ ] å®ç° `GET /api/v1/users/me`
- [ ] ä»Tokenè·å–ç”¨æˆ·ID
- [ ] æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
- [ ] è¿”å›ç”¨æˆ·å®Œæ•´ä¿¡æ¯

---

#### 3.2 æ›´æ–°ç”¨æˆ·èµ„æ–™API
- [ ] å®ç° `PATCH /api/v1/users/me`
- [ ] è¯·æ±‚å‚æ•°éªŒè¯ï¼ˆnickname, bio, genderç­‰ï¼‰
- [ ] æ›´æ–°ç”¨æˆ·ä¿¡æ¯
- [ ] æ£€æŸ¥èµ„æ–™å®Œæ•´åº¦ï¼ˆis_profile_completedï¼‰
- [ ] è¿”å›æ›´æ–°åçš„ç”¨æˆ·ä¿¡æ¯

---

#### 3.3 ä¸Šä¼ å¤´åƒAPI
- [ ] å®ç° `POST /api/v1/users/me/avatar`
- [ ] æ–‡ä»¶ä¸Šä¼ å¤„ç†ï¼ˆmultipart/form-dataï¼‰
- [ ] å›¾ç‰‡éªŒè¯ï¼ˆæ ¼å¼ã€å¤§å°ï¼‰
- [ ] ä¸Šä¼ åˆ°é˜¿é‡Œäº‘OSS
- [ ] æ›´æ–°ç”¨æˆ·avatarå­—æ®µ
- [ ] è¿”å›å¤´åƒURL

**å…³é”®æ­¥éª¤**ï¼š
```python
async def upload_avatar(
    file: UploadFile,
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    # 1. éªŒè¯æ–‡ä»¶æ ¼å¼å’Œå¤§å°
    # 2. ä¸Šä¼ åˆ°OSS
    # 3. è·å–URL
    # 4. æ›´æ–°ç”¨æˆ·avatar
    # 5. è¿”å›URL
```

---

### ğŸ“ é˜¶æ®µå››ï¼šæ ¸å¿ƒåŠŸèƒ½ï¼ˆå¯é€‰ï¼Œåç»­å¼€å‘ï¼‰

#### 4.1 å¸–å­ç®¡ç†API
- [ ] åˆ›å»ºå¸–å­ `POST /api/v1/posts`
- [ ] è·å–å¸–å­åˆ—è¡¨ `GET /api/v1/posts`
- [ ] è·å–å¸–å­è¯¦æƒ… `GET /api/v1/posts/{id}`
- [ ] æ›´æ–°å¸–å­ `PATCH /api/v1/posts/{id}`
- [ ] åˆ é™¤å¸–å­ `DELETE /api/v1/posts/{id}`
- [ ] ç‚¹èµå¸–å­ `POST /api/v1/posts/{id}/like`
- [ ] å–æ¶ˆç‚¹èµ `POST /api/v1/posts/{id}/unlike`
- [ ] è·å–è¯„è®º `GET /api/v1/posts/{id}/comments`
- [ ] æ·»åŠ è¯„è®º `POST /api/v1/posts/{id}/comments`

---

#### 4.2 æ¯”èµ›ç®¡ç†API
- [ ] åˆ›å»ºæ¯”èµ› `POST /api/v1/matches`
- [ ] è·å–æ¯”èµ›åˆ—è¡¨ `GET /api/v1/matches`
- [ ] è·å–æ¯”èµ›è¯¦æƒ… `GET /api/v1/matches/{id}`
- [ ] æ›´æ–°æ¯”èµ› `PATCH /api/v1/matches/{id}`
- [ ] åˆ é™¤æ¯”èµ› `DELETE /api/v1/matches/{id}`
- [ ] å‚ä¸æ¯”èµ› `POST /api/v1/matches/{id}/join`
- [ ] é€€å‡ºæ¯”èµ› `POST /api/v1/matches/{id}/leave`
- [ ] è·å–å‚ä¸è€… `GET /api/v1/matches/{id}/participants`

---

### ğŸ“ é˜¶æ®µäº”ï¼šæ‰©å±•åŠŸèƒ½ï¼ˆå¯é€‰ï¼Œåç»­å¼€å‘ï¼‰

#### 5.1 æ¶ˆæ¯ç³»ç»ŸAPI
- [ ] è·å–ä¼šè¯åˆ—è¡¨ `GET /api/v1/messages/conversations`
- [ ] è·å–ä¼šè¯è¯¦æƒ… `GET /api/v1/messages/conversations/{id}`
- [ ] å‘é€æ¶ˆæ¯ `POST /api/v1/messages/conversations/{id}/messages`
- [ ] æ ‡è®°å·²è¯» `POST /api/v1/messages/{id}/read`

---

#### 5.2 é€šçŸ¥ç³»ç»ŸAPI
- [ ] è·å–é€šçŸ¥åˆ—è¡¨ `GET /api/v1/notifications`
- [ ] è·å–æœªè¯»æ•°é‡ `GET /api/v1/notifications/unread-count`
- [ ] æ ‡è®°å·²è¯» `POST /api/v1/notifications/{id}/read`
- [ ] å…¨éƒ¨å·²è¯» `POST /api/v1/notifications/read-all`

---

### ğŸ“ é˜¶æ®µå…­ï¼šä¼˜åŒ–ä¸éƒ¨ç½²

#### 6.1 é”™è¯¯å¤„ç†ä¼˜åŒ–
- [ ] ç»Ÿä¸€å¼‚å¸¸å¤„ç†ä¸­é—´ä»¶
- [ ] è‡ªå®šä¹‰å¼‚å¸¸ç±»
- [ ] é”™è¯¯å“åº”æ ¼å¼ç»Ÿä¸€
- [ ] é”™è¯¯æ—¥å¿—è®°å½•

---

#### 6.2 ä¸­é—´ä»¶å®Œå–„
- [ ] è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶
- [ ] é™æµä¸­é—´ä»¶ï¼ˆé˜²æ­¢æ¶æ„è¯·æ±‚ï¼‰
- [ ] CORSä¸­é—´ä»¶é…ç½®
- [ ] TokenéªŒè¯ä¸­é—´ä»¶

---

#### 6.3 æµ‹è¯•
- [ ] å•å…ƒæµ‹è¯•ï¼ˆpytestï¼‰
- [ ] é›†æˆæµ‹è¯•ï¼ˆAPIæµ‹è¯•ï¼‰
- [ ] æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
- [ ] æ€§èƒ½æµ‹è¯•

---

#### 6.4 Dockeréƒ¨ç½²é…ç½®
- [ ] åˆ›å»º `Dockerfile`
- [ ] åˆ›å»º `docker-compose.yml`
- [ ] é…ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡
- [ ] é…ç½®Nginxåå‘ä»£ç†ï¼ˆå¯é€‰ï¼‰
- [ ] é…ç½®SSLè¯ä¹¦ï¼ˆå¯é€‰ï¼‰

---

## æŠ€æœ¯æ ˆä¸ä¾èµ–

### Pythonä¾èµ–åŒ…

```txt
# Webæ¡†æ¶
fastapi==0.104.1
uvicorn[standard]==0.24.0

# æ•°æ®åº“
sqlalchemy==2.0.23
alembic==1.12.1
psycopg2-binary==2.9.9

# æ•°æ®éªŒè¯
pydantic==2.5.0
pydantic-settings==2.1.0

# è®¤è¯ä¸å®‰å…¨
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
python-multipart==0.0.6

# çŸ­ä¿¡æœåŠ¡ï¼ˆé˜¿é‡Œäº‘ï¼‰
aliyun-python-sdk-core==2.14.0
aliyun-python-sdk-dysmsapi==2.2.0

# OSSå­˜å‚¨ï¼ˆé˜¿é‡Œäº‘ï¼‰
oss2==2.18.0

# Redisï¼ˆå¯é€‰ï¼‰
redis==5.0.1

# å·¥å…·
python-dotenv==1.0.0
loguru==0.7.2

# æµ‹è¯•
pytest==7.4.3
pytest-asyncio==0.21.1
httpx==0.25.2
```

---

## é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                      # FastAPIåº”ç”¨å…¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                        # æ ¸å¿ƒé…ç½®
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config.py                # é…ç½®ç®¡ç†ï¼ˆç¯å¢ƒå˜é‡ï¼‰
â”‚   â”‚   â”œâ”€â”€ security.py              # JWTå’Œå®‰å…¨å·¥å…·
â”‚   â”‚   â””â”€â”€ database.py              # æ•°æ®åº“è¿æ¥
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                      # SQLAlchemyæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ user.py                  # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ sms_code.py              # éªŒè¯ç æ¨¡å‹
â”‚   â”‚   â””â”€â”€ session.py               # ä¼šè¯æ¨¡å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/                     # Pydantic Schema
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ auth.py                  # è®¤è¯Schema
â”‚   â”‚   â”œâ”€â”€ user.py                  # ç”¨æˆ·Schema
â”‚   â”‚   â””â”€â”€ common.py                # é€šç”¨Schema
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                         # APIè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ v1/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ auth.py              # è®¤è¯è·¯ç”±
â”‚   â”‚       â””â”€â”€ users.py            # ç”¨æˆ·è·¯ç”±
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                    # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ auth_service.py          # è®¤è¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ sms_service.py           # çŸ­ä¿¡æœåŠ¡
â”‚   â”‚   â””â”€â”€ user_service.py          # ç”¨æˆ·æœåŠ¡
â”‚   â”‚
â”‚   â””â”€â”€ utils/                       # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ exceptions.py            # å¼‚å¸¸å¤„ç†
â”‚
â”œâ”€â”€ alembic/                         # æ•°æ®åº“è¿ç§»
â”‚   â”œâ”€â”€ versions/
â”‚   â””â”€â”€ env.py
â”‚
â”œâ”€â”€ tests/                           # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_auth.py
â”‚   â””â”€â”€ test_users.py
â”‚
â”œâ”€â”€ requirements.txt                 # Pythonä¾èµ–
â”œâ”€â”€ .env.example                     # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .gitignore
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ README.md
```

---

## å¼€å‘ä¼˜å…ˆçº§

### ğŸ”´ æœ€é«˜ä¼˜å…ˆçº§ï¼ˆå¿…é¡»å®Œæˆï¼‰
1. âœ… é¡¹ç›®åˆå§‹åŒ–
2. âœ… æ•°æ®åº“é…ç½®
3. âœ… æ ¸å¿ƒé…ç½®æ¨¡å—
4. âœ… æ•°æ®æ¨¡å‹å®šä¹‰
5. âœ… Schemaå®šä¹‰
6. âœ… çŸ­ä¿¡æœåŠ¡é›†æˆ
7. âœ… å‘é€éªŒè¯ç API
8. âœ… éªŒè¯ç ç™»å½•API
9. âœ… Tokenåˆ·æ–°API
10. âœ… ç™»å‡ºAPI
11. âœ… è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯API
12. âœ… æ›´æ–°ç”¨æˆ·èµ„æ–™API
13. âœ… ä¸Šä¼ å¤´åƒAPI
14. âœ… ä¸»åº”ç”¨é…ç½®
15. âœ… é”™è¯¯å¤„ç†

### ğŸŸ¡ é«˜ä¼˜å…ˆçº§ï¼ˆé‡è¦åŠŸèƒ½ï¼‰
16. ä¸­é—´ä»¶å®Œå–„
17. å•å…ƒæµ‹è¯•
18. Dockeréƒ¨ç½²é…ç½®

### ğŸŸ¢ ä¸­ä¼˜å…ˆçº§ï¼ˆåç»­å¼€å‘ï¼‰
19. å¸–å­ç®¡ç†API
20. æ¯”èµ›ç®¡ç†API
21. æ¶ˆæ¯ç³»ç»ŸAPI
22. é€šçŸ¥ç³»ç»ŸAPI

---

## æµ‹è¯•è®¡åˆ’

### å•å…ƒæµ‹è¯•
- [ ] æµ‹è¯•JWTç”Ÿæˆå’ŒéªŒè¯
- [ ] æµ‹è¯•éªŒè¯ç ç”Ÿæˆå’ŒéªŒè¯
- [ ] æµ‹è¯•ç”¨æˆ·åˆ›å»ºå’ŒæŸ¥è¯¢
- [ ] æµ‹è¯•æ•°æ®åº“æ“ä½œ

### é›†æˆæµ‹è¯•
- [ ] æµ‹è¯•å‘é€éªŒè¯ç æµç¨‹
- [ ] æµ‹è¯•ç™»å½•æµç¨‹
- [ ] æµ‹è¯•Tokenåˆ·æ–°æµç¨‹
- [ ] æµ‹è¯•ç”¨æˆ·ä¿¡æ¯æ›´æ–°æµç¨‹
- [ ] æµ‹è¯•å¤´åƒä¸Šä¼ æµç¨‹

### APIæµ‹è¯•
ä½¿ç”¨ Postman æˆ– pytest æµ‹è¯•æ‰€æœ‰APIç«¯ç‚¹ï¼š
- [ ] POST /api/v1/auth/send-sms-code
- [ ] POST /api/v1/auth/login-with-sms
- [ ] POST /api/v1/auth/refresh-token
- [ ] POST /api/v1/auth/logout
- [ ] GET /api/v1/users/me
- [ ] PATCH /api/v1/users/me
- [ ] POST /api/v1/users/me/avatar

---

## éƒ¨ç½²è®¡åˆ’

### å¼€å‘ç¯å¢ƒ
- [ ] æœ¬åœ°PostgreSQLæ•°æ®åº“
- [ ] æœ¬åœ°Redisï¼ˆå¯é€‰ï¼‰
- [ ] å¼€å‘ç¯å¢ƒå˜é‡é…ç½®
- [ ] çƒ­é‡è½½å¼€å‘æœåŠ¡å™¨

### ç”Ÿäº§ç¯å¢ƒ
- [ ] Dockerå®¹å™¨åŒ–
- [ ] PostgreSQLäº‘æ•°æ®åº“ï¼ˆRDSï¼‰
- [ ] Redisäº‘æœåŠ¡ï¼ˆå¯é€‰ï¼‰
- [ ] Nginxåå‘ä»£ç†
- [ ] SSLè¯ä¹¦é…ç½®
- [ ] æ—¥å¿—æ”¶é›†å’Œç›‘æ§

---

## å¼€å‘æ—¶é—´ä¼°ç®—

| é˜¶æ®µ | ä»»åŠ¡æ•° | é¢„è®¡æ—¶é—´ |
|------|--------|---------|
| é˜¶æ®µä¸€ï¼šåŸºç¡€æ­å»º | 5ä¸ªä»»åŠ¡ | 2-3å¤© |
| é˜¶æ®µäºŒï¼šè®¤è¯ç³»ç»Ÿ | 5ä¸ªä»»åŠ¡ | 3-4å¤© |
| é˜¶æ®µä¸‰ï¼šç”¨æˆ·ç®¡ç† | 3ä¸ªä»»åŠ¡ | 2-3å¤© |
| é˜¶æ®µå››ï¼šæ ¸å¿ƒåŠŸèƒ½ | 2ä¸ªä»»åŠ¡ | 4-5å¤© |
| é˜¶æ®µäº”ï¼šæ‰©å±•åŠŸèƒ½ | 2ä¸ªä»»åŠ¡ | 3-4å¤© |
| é˜¶æ®µå…­ï¼šä¼˜åŒ–éƒ¨ç½² | 4ä¸ªä»»åŠ¡ | 2-3å¤© |
| **æ€»è®¡** | **21ä¸ªä»»åŠ¡** | **16-22å¤©** |

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³å¼€å§‹**ï¼šé˜¶æ®µä¸€ - åŸºç¡€æ­å»º
2. **å‚è€ƒæ–‡æ¡£**ï¼š
   - `é¡¹ç›®ä»‹ç»/åç«¯APIè®¾ç½®æ–‡æ¡£.md` - APIè¯¦ç»†è§„èŒƒ
   - `é¡¹ç›®ä»‹ç»/æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md` - æ•°æ®åº“ç»“æ„
   - `lib/config/api_config.dart` - å‰ç«¯APIç«¯ç‚¹å®šä¹‰

3. **å¼€å‘é¡ºåº**ï¼š
   ```
   é¡¹ç›®åˆå§‹åŒ– â†’ æ•°æ®åº“é…ç½® â†’ æ ¸å¿ƒé…ç½® â†’ æ•°æ®æ¨¡å‹ â†’ Schema â†’ 
   çŸ­ä¿¡æœåŠ¡ â†’ è®¤è¯API â†’ ç”¨æˆ·API â†’ æµ‹è¯• â†’ éƒ¨ç½²
   ```

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**åˆ›å»ºæ—¥æœŸ**ï¼š2025-11-06  
**æœ€åæ›´æ–°**ï¼š2025-11-06

